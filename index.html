<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Tracker</title>
  <style>
    body { font-family: sans-serif; max-width: 400px; margin: auto; padding: 1rem; }
    .card { border: 1px solid #ccc; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; }
    .bold { font-weight: bold; }
    .button { padding: 0.5rem 1rem; border: none; border-radius: 5px; cursor: pointer; }
    .button.full { width: 100%; margin-top: 0.5rem; }
    .flex { display: flex; justify-content: space-between; align-items: center; }
    .input, select { width: 100%; padding: 0.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="card">
    <div class="bold">รายรับ-รายจ่าย</div>
    <select id="monthSelect" class="input"></select>
    <button class="button full" onclick="showAddForm()">เพิ่มรายการ</button>
  </div>

  <div class="card hidden" id="addForm">
    <div class="bold">บันทึกรายการ</div>
    <select id="descSelect" class="input" onchange="handleDescChange()"></select>
    <input id="customDesc" class="input hidden" placeholder="ระบุรายการใหม่" />
    <input id="amountInput" class="input" type="number" placeholder="จำนวนเงิน" />
    <div class="flex">
      <button class="button" onclick="addItem(false)">บันทึก</button>
      <button class="button" onclick="hideAddForm()">ยกเลิก</button>
    </div>
    <div class="flex">
      <button class="button" onclick="addItem(true)">เพิ่มทุกเดือน</button>
    </div>
  </div>

  <div class="card">
    <div class="flex">
      <div class="bold">รายการเดือน <span id="monthLabel"></span></div>
      <div id="statusDot" style="width: 10px; height: 10px; border-radius: 50%;"></div>
    </div>
    <div id="itemList"></div>
    <div style="border-top: 1px solid #ccc; margin-top: 0.5rem; padding-top: 0.5rem;">
      <div class="flex"><span class="bold">รายรับรวม</span><span id="incomeTotal"></span></div>
      <div class="flex"><span class="bold">รายจ่ายรวม</span><span id="expenseTotal"></span></div>
      <div class="flex"><span class="bold">ยอดสุทธิ</span><span id="netTotal"></span></div>
    </div>
  </div>

  <script>
    const months = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
    const predefinedAmounts = {"ค่าห้อง": 3000, "ค่าห้อง - ค่าเน็ต": 320, "ให้แม่": 1000, "กองกลาง": 2000, "ออมสหกรณ์ปราสาท": 500, "ทำบุญ": 200};
    const descOptions = ["รายรับ", "ค่าบัตร", "ค่าห้อง", "ค่าห้อง - ค่าน้ำ", "ค่าห้อง - ค่าไฟ", "ค่าห้อง - ค่าเน็ต", "ให้แม่", "กองกลาง", "ใช้จ่ายส่วนตัว", "ออมสหกรณ์ปราสาท", "ทำบุญ", "ออมไว้สำรอง"];

    let items = JSON.parse(localStorage.getItem("expenseItems") || "[]");
    let selectedMonth = new Date().getMonth();
    let isCustom = false;

    const monthSelect = document.getElementById("monthSelect");
    const descSelect = document.getElementById("descSelect");
    const customDesc = document.getElementById("customDesc");
    const amountInput = document.getElementById("amountInput");
    const itemList = document.getElementById("itemList");
    const monthLabel = document.getElementById("monthLabel");
    const incomeTotal = document.getElementById("incomeTotal");
    const expenseTotal = document.getElementById("expenseTotal");
    const netTotal = document.getElementById("netTotal");
    const statusDot = document.getElementById("statusDot");

    months.forEach((m, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = m;
      monthSelect.appendChild(opt);
    });

    descOptions.forEach(opt => {
      const el = document.createElement("option");
      el.value = opt;
      el.textContent = opt;
      descSelect.appendChild(el);
    });
    const otherOpt = document.createElement("option");
    otherOpt.value = "อื่นๆ";
    otherOpt.textContent = "อื่นๆ";
    descSelect.appendChild(otherOpt);

    monthSelect.value = selectedMonth;
    monthSelect.onchange = () => { selectedMonth = parseInt(monthSelect.value); render(); };

    function showAddForm() { document.getElementById("addForm").classList.remove("hidden"); }
    function hideAddForm() { document.getElementById("addForm").classList.add("hidden"); }

    function handleDescChange() {
      const value = descSelect.value;
      isCustom = value === "อื่นๆ";
      customDesc.classList.toggle("hidden", !isCustom);
      amountInput.value = predefinedAmounts[value] || "";
    }

    function addItem(repeatAllMonths) {
      const desc = isCustom ? customDesc.value : descSelect.value;
      const amount = parseFloat(amountInput.value);
      if (!desc || isNaN(amount)) return;
      const baseItem = { desc, amount, isChecked: false };

      const newItems = repeatAllMonths
        ? months.map((_, idx) => ({ ...baseItem, month: idx }))
        : [{ ...baseItem, month: selectedMonth }];

      items.push(...newItems);
      localStorage.setItem("expenseItems", JSON.stringify(items));
      hideAddForm();
      render();
    }

    function toggleChecked(index) {
      const realIndex = items.findIndex((item, i) => item.month === selectedMonth && i === index);
      items[realIndex].isChecked = !items[realIndex].isChecked;
      localStorage.setItem("expenseItems", JSON.stringify(items));
      render();
    }

    function deleteItem(index) {
      const realIndex = items.findIndex((item, i) => item.month === selectedMonth && i === index);
      items.splice(realIndex, 1);
      localStorage.setItem("expenseItems", JSON.stringify(items));
      render();
    }

    function render() {
      const filtered = items.filter(item => item.month === selectedMonth);
      itemList.innerHTML = "";

      let income = 0, expense = 0;
      filtered.forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "flex";
        row.innerHTML = `<div><button class="button" onclick="toggleChecked(${idx})">${item.isChecked ? '✓' : '○'}</button> ${item.desc}</div><div>${item.amount.toFixed(2)} <button onclick="deleteItem(${idx})">ลบ</button></div>`;
        itemList.appendChild(row);
        if (item.desc === "รายรับ") income += item.amount;
        else expense += item.amount;
      });

      incomeTotal.textContent = income.toFixed(2) + " บาท";
      expenseTotal.textContent = expense.toFixed(2) + " บาท";
      netTotal.textContent = (income - expense).toFixed(2) + " บาท";
      monthLabel.textContent = months[selectedMonth];
      statusDot.style.backgroundColor = filtered.every(i => i.isChecked) ? 'green' : 'red';
    }

    render();
  </script>
</body>
</html>
